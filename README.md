# GRANGER
Granger recurrent autoencoders to network gene expression regulations

## Requirements
GRANGER requires you to create a PyTorch environment and install the following packages

python                    3.11.5 

pytorch                   2.1.0

pandas                    2.1.4

scanpy                    1.10.1

scikit-learn              1.2.2

numpy                     1.26.0 


## Scripts
### The code of GRANGER mainly includes the following scripts:

**timepseudo.py**: this script is used to process data with time-series information, which can reorder cells  according to the information in refNetwork.csv and generate a new input file. For data without time  information, you can use to_npy to directly generate an input file.

**proprocess.py**: define some functions that you can use to obtain tf_list (list of transcription factors) and gene expression matrix, and format label files and calculate AUROC and AUPR.

**GRANGER_demo.py**:run the model and defines some parameters that you can adjust to achieve better results.

**granger_model.py**: The main code of the model, which contains the framework of the model. It will generate a matrix reflecting the strength of regulatory relationships between genes and save it as a CSV file. You can use it for subsequent analysis.

**generate_res.py**: Further process the intensity score matrix generated by the model to obtain a standard format (gene_A gene_B correlation_score) for analysis.


## Usage
### Step 1 
Firstly, you can use the processed file(.npy) we provide, which can be directly input into the model for inference of gene regulatory networks. If you want to use other datasets, we also provide scripts for processing gene expression matrices (.csv). For data with pseudotime sorting, you can use timepseudo.py to reorder the ExpressionData file based on the PseudoTime.csv file, generate a new ExpressionData file, and then use process it into npy format through "generate_res.py"

### Step 2
For the marked data, please modify the correct file path in GRANGER_demo.py and granger_madel.py, and then run GRANGERA_demo.py directly，Please note that our model is unsupervised learning and does not use pre trained models to discover hidden structures. You need to adjust some parameters to achieve better results. Typically, lr between 1e-3 and 10e-3 will achieve ideal results. If you want to use unlabeled data, you need to comment out the use of proprrocess.py in granger_madel.py.

### Step 3
Using generate_res.py can help you convert the intensity score matrix into the form of a:b:type:correction:score, helping you find the most representative inference relationships for further biological analysis.

### Please note that
You can adjust these parameters for different datasets to achieve better results, context, lam, lr, max_iter, batch_size， We have already explained these parameters in detail in the paper.
If you input too many genes or certain parameters, it may consume a large amount of GPU memory, causing memory overflow and interrupting the process.
